---
typora-root-url: .
typora-copy-images-to: ..\assets\img
---

# 一、事务

**事务：**由一系列对系统中数据进行访问与更新的操作所组成的一个程序执行逻辑单元，狭义上的事务特质数据库事务。

**ACID：**事务的四个特征，原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）

1. **原子性：**全部执行或全部不执行
2. **一致性：**事务的执行不能破坏数据库数据的完整性和一致性，一个事务在执行之前和执行之后，数据库偶读必须处于一致性状态
3. **隔离性：**并发的事务互相隔离，一个事务的执行不能被其他事务干扰。
4. **持久性**：指一个事务一旦提交，它对数据库中对应数据的状态变更就是永久性的。即使发生系统崩溃或机器宕机等故障，只要数据库能够重新启动，那么一定能够将其恢复到事务成功结束时的状态。

 

**事务的隔离级别：**

1. 读未提交（未授权读取）：允许脏读，隔离级别最低。换句话说，如果一个事务正在处理某一数据，并对其进行了更新，但同时尚未完成事务，因此还没有进行事务提交；而与此同时，允许另一个事务也能够访问该数据。
2. 授权读取（读已提交）：只允许读已经被提交的数据。
3. 可重复读：在事务处理过程中，多次读取同一个数据时，其值都和事务开始时刻是一致的。因此该级别禁止了不可重复读取和脏读。可能出现幻读。
4. 串行化：最严格。要求所有事务都被穿行执行。

 

> ***幻读，****并不是说两次读取获取的结果集不同，幻读侧重的方面是某一次的* *select* *操作得到的结果所表征的数据状态无法支撑后续的业务操作。更为具体一些：**select* *某记录是否存在，不存在，准备插入此记录，但执行* *insert* *时发现此记录已存在，无法插入，此时就发生了幻读。*



**Redo、Undo日志**

redo log 是重做日志，提供**前滚**操作；undo log 是回退日志，提供**回滚**操作。

1. redo log 通常是 **物理** 日志，记录的是 **数据页**      的物理修改，而不是某一行或某几行修改成怎样怎样，它用来恢复提交后的物理数据页(恢复数据页，且只能恢复到最后一次提交的位置)。
2. undo log 用来回滚行记录到某个版本。undo log      一般是逻辑日志，根据每行记录进行记录。

 

 

# 二、乐观锁与悲观锁

 **1、悲观锁**

悲观锁是指假设并发更新冲突会发生，所以不管冲突是否真的发生，都会使用锁机制。

悲观锁会完成以下功能：锁住读取的记录，防止其它事务读取和更新这些记录。其它事务会一直阻塞，直到这个事务结束。

悲观锁是在使用了数据库的事务隔离功能的基础上，独享占用的资源，以此保证读取数据一致性，避免修改丢失。

悲观锁可以使用Repeatable Read事务，它完全满足悲观锁的要求。

**2、乐观锁**

乐观锁不会锁住任何东西，也就是说，它不依赖数据库的事务机制，乐观锁完全是应用系统层面的东西。

如果使用乐观锁，那么数据库就必须加版本字段，否则就只能比较所有字段，但因为浮点类型不能比较，所以实际上没有版本字段是不可行的。

MVCC 多版本并发控制

 

# 三、MySQL存储引擎

- MyISAM 不支持事务，InnoDB 是事务类型的存储引擎；
- MyISAM 只支持表级锁，BDB      支持页级锁和表级锁，默认为页级锁；而 InnoDB 支持行级锁和表级锁，默认为行级锁；
- MyISAM引擎不支持外键，InnoDB 支持外键；
- MyISAM引擎的表在大量高并发的读写下会经常出现表损坏的情况；
- 对于 count( ) 查询来说 MyISAM 更有优势；
- InnoDB 是为处理巨大数据量时的最大性能设计，它的 CPU效率可能是任何其它基于磁盘的关系数据库引擎所不能匹敌的；
- MyISAM 支持全文索引（FULLTEXT），InnoDB不支持；
- MyISAM 引擎的表的查询、更新、插入的效率要比 InnoDB高。

**最主要的区别是：**MyISAM 表不支持事务、不支持行级锁、不支持外键。 InnoDB 表支持事务、支持行级锁、支持外键。（可直接回答这个）

 

# 四、三大范式

1. 第一范式 原子性，属性不可再分
2. 第二范式 主键，非主属性需完全依赖于主键（消除部分依赖，去掉联合主键）
3. 第三范式 属性不依赖于其它非主属性（消除传递依赖）

 

# 五、集合运算

**Union和UnionAll的区别**

1. Union：对两个结果集进行并集操作，不包括重复行，同时进行默认规则的排序； 
2. Union      All：对两个结果集进行并集操作，包括重复行，不进行排序； 

 

# 六、连接运算

1. left join(左联接)      返回包括左表中的所有记录和右表中联结字段相等的记录 
2. right join(右联接)      返回包括右表中的所有记录和左表中联结字段相等的记录
3. inner join(等值连接) 只返回两个表中联结字段相等的行

 

 

# 参考文章

1. [mysql      幻读的详解、实例及解决办法](https://segmentfault.com/a/1190000016566788)
2. [《从Paxos到Zookeeper》读书笔记（一）](https://guoyang1996.github.io/zookeeper1/)

 